@startuml
' Simple Weather Station architecture
title Weather Station

skinparam componentStyle rectangle
skinparam shadowing false

package "Field Devices" {
  node "Weather Station (ESP32)" as WeatherDevice {
    component "Microcontroller\n(Firmware)" as MCU
    component "Light\n(LDR / BH1750)" as Light
    component "Wind speed\n(Anemometer)" as WindSpeed
    component "Wind direction\n(Wind Vane)" as WindDir
    component "Temperature\n(DHT22)" as Temp
    component "Humidity\n(DHT22)" as Humidity
  }
  node "Sunscreen Controller\n(Actuator Device - ESP8266/ESP32)\n(Indoor)" as ActuatorDevice {
    component "Microcontroller\n(Firmware)" as ActMCU
    component "Sunscreen Actuator\n(Servo / Motor / Relay)" as Actuator
    component "Position feedback\n(Encoder / Limit switches)" as Position
  }
}

package "Connectivity" {
  component "MQTT Broker\n(Mosquitto / Cloud MQTT)" as MQTT
  component "HTTP / REST" as HTTP
}

package "Cloud / Backend" {
  component "Ingest / Processor" as Processor
  component "Web Dashboard / API" as Dashboard
}

Light --> MCU : "sensor read"
WindSpeed --> MCU : "sensor read"
WindDir --> MCU : "sensor read"
Temp --> MCU : "sensor read"
Humidity --> MCU : "sensor read"

MCU --> MQTT : "publish telemetry (MQTT/TLS)\nJSON payload"
ActMCU --> Actuator : "local control (GPIO/PWM)\nopen/close sunscreen"
ActMCU --> MQTT : "publish actuator telemetry / state\nMQTT/TLS"
MQTT --> ActMCU : "remote command (MQTT/TLS)\ndevices/{actuator_id}/actuator/command"
Actuator --> ActMCU : "position feedback (encoder/limit)"
MQTT --> Processor : "ingest / fan-out"
Dashboard --> Processor : "user queries / graphs"
Processor --> Dashboard : "API responses"

note left of MCU
  - Sample sensors (e.g., every 10s)
  - Aggregate wind speed/direction locally
  - Minimal payload: light, wind_speed, wind_dir, temp, humidity
end note

note right of MQTT
  Security: MQTT over TLS, device auth (certs or tokens)
end note

' Tips:
' - Use retained MQTT for last-known values.
' - Use signed OTA for firmware updates.

@enduml